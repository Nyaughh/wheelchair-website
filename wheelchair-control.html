<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voice Controlled Wheelchair</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
        color: white;
        min-height: 100vh;
        overflow-x: hidden;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        padding: 40px 0;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0.05) 100%
        );
        border-radius: 20px;
        margin-bottom: 30px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 300;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #fff, #ccc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .status-card {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0.05) 100%
        );
        border-radius: 15px;
        padding: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .status-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .status-online {
        background: rgba(34, 197, 94, 0.2);
        border: 1px solid rgba(34, 197, 94, 0.3);
        color: #4ade80;
      }

      .status-offline {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #f87171;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        box-shadow: 0 0 8px currentColor;
      }

      .control-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
      }

      .control-card {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0.05) 100%
        );
        border-radius: 20px;
        padding: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .control-card h3 {
        font-size: 1.3rem;
        margin-bottom: 20px;
        font-weight: 300;
        color: #e5e7eb;
      }

      .button-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .btn {
        padding: 15px 20px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        color: white;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
      }

      .btn-danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
      }

      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
      }

      .btn-emergency {
        background: linear-gradient(135deg, #f97316, #ea580c);
        color: white;
        box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
        animation: pulse 2s infinite;
        grid-column: span 2;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
        }
      }

      .btn-emergency:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
      }

      .input-group {
        margin-bottom: 20px;
      }

      .input-group label {
        display: block;
        margin-bottom: 8px;
        color: #9ca3af;
        font-size: 0.9rem;
      }

      .input-group input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.3);
        color: white;
        font-size: 0.9rem;
      }

      .input-group input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .log-container {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        height: 300px;
        overflow-y: auto;
        font-family: "Courier New", monospace;
        font-size: 0.85rem;
      }

      .log-entry {
        padding: 5px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .log-entry:last-child {
        border-bottom: none;
      }

      .log-timestamp {
        color: #6b7280;
      }

      .log-error {
        color: #f87171;
      }

      .log-success {
        color: #4ade80;
      }

      .location-info {
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
      }

      .location-info h4 {
        color: #60a5fa;
        margin-bottom: 10px;
      }

      .coordinates {
        font-family: monospace;
        font-size: 1.1rem;
        color: white;
        margin-bottom: 5px;
      }

      .accuracy {
        color: #9ca3af;
        font-size: 0.9rem;
      }

      .voice-commands {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
      }

      .voice-commands h4 {
        color: #4ade80;
        margin-bottom: 10px;
      }

      .command-list {
        color: #d1d5db;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #ffffff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .status-grid {
          grid-template-columns: 1fr;
        }

        .control-section {
          grid-template-columns: 1fr;
        }

        .button-grid {
          grid-template-columns: 1fr;
        }

        .btn-emergency {
          grid-column: span 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Voice Controlled Wheelchair</h1>
        <p>Control your wheelchair with voice commands or manual controls</p>
      </div>

      <div class="status-grid">
        <div class="status-card">
          <h4>Connection Status</h4>
          <div id="connectionStatus" class="status-indicator status-offline">
            <div class="status-dot"></div>
            <span>Offline</span>
          </div>
        </div>

        <div class="status-card">
          <h4>Voice Control</h4>
          <div id="voiceStatus" class="status-indicator status-offline">
            <div class="status-dot"></div>
            <span>Inactive</span>
          </div>
        </div>

        <div class="status-card">
          <h4>GPS Location</h4>
          <div id="gpsStatus" class="status-indicator status-offline">
            <div class="status-dot"></div>
            <span>Not Located</span>
          </div>
        </div>

        <div class="status-card">
          <h4>Emergency Email</h4>
          <div id="emailStatus" class="status-indicator status-offline">
            <div class="status-dot"></div>
            <span>Not Configured</span>
          </div>
        </div>
      </div>

      <div class="control-section">
        <div class="control-card">
          <h3>Device Configuration</h3>
          <div class="input-group">
            <label for="deviceUrl">Device URL</label>
            <input
              type="text"
              id="deviceUrl"
              placeholder="http://192.168.1.14"
              value="http://192.168.1.14"
            />
          </div>
          <div class="button-grid">
            <button class="btn btn-primary" onclick="saveDeviceUrl()">
              Save Configuration
            </button>
            <button class="btn btn-primary" onclick="testConnection()">
              Test Connection
            </button>
          </div>
        </div>

        <div class="control-card">
          <h3>Emergency Email</h3>
          <div class="input-group">
            <label for="emergencyEmail">Emergency Email Address</label>
            <input
              type="email"
              id="emergencyEmail"
              placeholder="emergency@example.com"
            />
          </div>
          <div class="button-grid">
            <button class="btn btn-primary" onclick="saveEmailConfig()">
              Save Email
            </button>
            <button class="btn btn-primary" onclick="testEmail()">
              Test Email
            </button>
          </div>
        </div>
      </div>

      <div class="control-section">
        <div class="control-card">
          <h3>Manual Controls</h3>
          <div class="button-grid">
            <button class="btn btn-primary" onclick="sendCommand('forward')">
              Move Forward
            </button>
            <button class="btn btn-danger" onclick="sendCommand('stop')">
              Stop
            </button>
            <button
              class="btn btn-emergency"
              onclick="sendCommand('emergency')"
            >
              EMERGENCY
            </button>
            <button class="btn btn-primary" onclick="sendCommand('back')">
              Move Back
            </button>
          </div>
        </div>

        <div class="control-card">
          <h3>Voice Controls</h3>
          <button
            id="voiceButton"
            class="btn btn-success"
            onclick="toggleVoiceControl()"
            style="width: 100%; margin-bottom: 15px"
          >
            Start Voice Control
          </button>
          <div class="voice-commands">
            <h4>Voice Commands</h4>
            <div class="command-list">
              • "forward" - Move forward<br />
              • "back" - Move backward<br />
              • "stop" - Stop movement<br />
              • "emergency" - Send emergency alert<br />
              • "help" - Send emergency alert<br />
              • "alert" - Send emergency alert
            </div>
          </div>
        </div>
      </div>

      <div class="control-section">
        <div class="control-card">
          <h3>GPS Location</h3>
          <div id="locationInfo">
            <p>Click "Get Location" to enable GPS tracking</p>
          </div>
          <div class="button-grid">
            <button class="btn btn-primary" onclick="getLocation()">
              Get Location
            </button>
            <button class="btn btn-primary" onclick="openInMaps()">
              Open in Maps
            </button>
          </div>
        </div>

        <div class="control-card">
          <h3>Activity Log</h3>
          <div id="logContainer" class="log-container">
            <div class="log-entry">
              <span class="log-timestamp">[System Ready]</span> Voice Controlled
              Wheelchair initialized
            </div>
          </div>
          <button
            class="btn btn-primary"
            onclick="clearLog()"
            style="width: 100%; margin-top: 15px"
          >
            Clear Log
          </button>
        </div>
      </div>
    </div>

    <script>
      let isListening = false;
      let recognition = null;
      let deviceUrl = "http://192.168.1.14";
      let emergencyEmail = "";
      let currentLocation = null;
      let isOnline = false;

      function addLog(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const logContainer = document.getElementById("logContainer");
        const logEntry = document.createElement("div");
        logEntry.className = "log-entry";

        let className = "";
        if (type === "error") className = "log-error";
        else if (type === "success") className = "log-success";

        logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span> 
                <span class="${className}">${message}</span>
            `;

        logContainer.appendChild(logEntry);
        logContainer.scrollTop = logContainer.scrollHeight;
      }

      function clearLog() {
        document.getElementById("logContainer").innerHTML = "";
        addLog("Log cleared");
      }

      function updateStatus(elementId, isOnline, text) {
        const element = document.getElementById(elementId);
        element.className = `status-indicator ${
          isOnline ? "status-online" : "status-offline"
        }`;
        element.querySelector("span").textContent = text;
      }

      function saveDeviceUrl() {
        deviceUrl = document.getElementById("deviceUrl").value.trim();
        if (!deviceUrl) {
          addLog("Please enter a device URL", "error");
          return;
        }
        if (!deviceUrl.startsWith("http")) {
          deviceUrl = "http://" + deviceUrl;
        }
        localStorage.setItem("deviceUrl", deviceUrl);
        addLog(`Device URL saved: ${deviceUrl}`, "success");
        testConnection();
      }

      function testConnection() {
        addLog("Testing connection...");
        fetch(deviceUrl, {
          method: "GET",
          signal: AbortSignal.timeout(3000),
        })
          .then((response) => {
            isOnline = true;
            updateStatus("connectionStatus", true, "Online");
            addLog("Connection successful", "success");
          })
          .catch((error) => {
            isOnline = false;
            updateStatus("connectionStatus", false, "Offline");
            addLog(`Connection failed: ${error.message}`, "error");
          });
      }

      function sendCommand(command) {
        if (!isOnline) {
          addLog("Device is offline. Please check connection.", "error");
          return;
        }

        addLog(`Sending command: ${command}`);

        if (command === "emergency" && currentLocation) {
          sendEmergencyEmail();
        }

        fetch(`${deviceUrl}/${command}`, {
          method: "GET",
          signal: AbortSignal.timeout(3000),
        })
          .then((response) => {
            if (response.ok) {
              addLog(`Command sent successfully: ${command}`, "success");
            } else {
              throw new Error(`HTTP ${response.status}`);
            }
          })
          .catch((error) => {
            addLog(`Command failed: ${error.message}`, "error");
          });
      }

      function toggleVoiceControl() {
        if (
          !("webkitSpeechRecognition" in window) &&
          !("SpeechRecognition" in window)
        ) {
          addLog("Speech recognition not supported in this browser", "error");
          return;
        }

        if (isListening) {
          stopVoiceControl();
        } else {
          startVoiceControl();
        }
      }

      function startVoiceControl() {
        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = "en-US";
        recognition.continuous = true;
        recognition.interimResults = false;

        recognition.onstart = () => {
          isListening = true;
          updateStatus("voiceStatus", true, "Listening");
          document.getElementById("voiceButton").textContent =
            "Stop Voice Control";
          addLog("Voice control started", "success");
        };

        recognition.onresult = (event) => {
          const transcript =
            event.results[event.results.length - 1][0].transcript.toLowerCase();
          addLog(`Heard: "${transcript}"`);

          if (transcript.includes("forward")) {
            sendCommand("forward");
          } else if (transcript.includes("back")) {
            sendCommand("back");
          } else if (transcript.includes("stop")) {
            sendCommand("stop");
          } else if (
            transcript.includes("emergency") ||
            transcript.includes("help") ||
            transcript.includes("alert")
          ) {
            sendCommand("emergency");
          } else {
            addLog("Command not recognized", "error");
          }
        };

        recognition.onerror = (event) => {
          addLog(`Speech recognition error: ${event.error}`, "error");
        };

        recognition.onend = () => {
          if (isListening) {
            recognition.start();
          }
        };

        recognition.start();
      }

      function stopVoiceControl() {
        isListening = false;
        if (recognition) {
          recognition.stop();
        }
        updateStatus("voiceStatus", false, "Inactive");
        document.getElementById("voiceButton").textContent =
          "Start Voice Control";
        addLog("Voice control stopped");
      }

      function getLocation() {
        if (!navigator.geolocation) {
          addLog("Geolocation is not supported by this browser", "error");
          return;
        }

        addLog("Getting location...");
        updateStatus("gpsStatus", false, "Locating...");

        navigator.geolocation.getCurrentPosition(
          (position) => {
            currentLocation = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
              accuracy: position.coords.accuracy,
              timestamp: position.timestamp,
            };

            updateStatus("gpsStatus", true, "Located");
            updateLocationDisplay();
            addLog(
              `Location obtained: ${currentLocation.latitude.toFixed(
                6
              )}, ${currentLocation.longitude.toFixed(6)}`,
              "success"
            );
          },
          (error) => {
            let errorMessage = "Unknown error occurred";
            switch (error.code) {
              case error.PERMISSION_DENIED:
                errorMessage = "Location permission denied";
                break;
              case error.POSITION_UNAVAILABLE:
                errorMessage = "Location information unavailable";
                break;
              case error.TIMEOUT:
                errorMessage = "Location request timed out";
                break;
            }
            updateStatus("gpsStatus", false, "Error");
            addLog(`Location error: ${errorMessage}`, "error");
          },
          {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000,
          }
        );
      }

      function updateLocationDisplay() {
        if (!currentLocation) return;

        const locationInfo = document.getElementById("locationInfo");
        locationInfo.innerHTML = `
                <div class="location-info">
                    <h4>Current Location</h4>
                    <div class="coordinates">${currentLocation.latitude.toFixed(
                      6
                    )}, ${currentLocation.longitude.toFixed(6)}</div>
                    <div class="accuracy">Accuracy: ${
                      currentLocation.accuracy < 10
                        ? currentLocation.accuracy.toFixed(1) + "m"
                        : (currentLocation.accuracy / 1000).toFixed(1) + "km"
                    }</div>
                    <div class="accuracy">Updated: ${new Date(
                      currentLocation.timestamp
                    ).toLocaleTimeString()}</div>
                </div>
            `;
      }

      function openInMaps() {
        if (!currentLocation) {
          addLog("No location available", "error");
          return;
        }
        const url = `https://www.google.com/maps?q=${currentLocation.latitude},${currentLocation.longitude}`;
        window.open(url, "_blank");
      }

      function saveEmailConfig() {
        emergencyEmail = document.getElementById("emergencyEmail").value.trim();
        if (!emergencyEmail) {
          addLog("Please enter an emergency email address", "error");
          return;
        }
        localStorage.setItem("emergencyEmail", emergencyEmail);
        updateStatus("emailStatus", true, "Configured");
        addLog("Emergency email saved", "success");
      }

      function testEmail() {
        if (!emergencyEmail) {
          addLog("Please configure emergency email first", "error");
          return;
        }
        addLog(
          "Email functionality requires server-side implementation",
          "error"
        );
      }

      function sendEmergencyEmail() {
        if (!emergencyEmail) {
          addLog("Emergency email not configured", "error");
          return;
        }
        if (!currentLocation) {
          addLog("No location available for emergency alert", "error");
          return;
        }
        addLog(
          "Emergency alert triggered! Email functionality requires server-side implementation",
          "error"
        );
      }

      function initialize() {
        const savedDeviceUrl = localStorage.getItem("deviceUrl");
        if (savedDeviceUrl) {
          deviceUrl = savedDeviceUrl;
          document.getElementById("deviceUrl").value = deviceUrl;
        }

        const savedEmail = localStorage.getItem("emergencyEmail");
        if (savedEmail) {
          emergencyEmail = savedEmail;
          document.getElementById("emergencyEmail").value = emergencyEmail;
          updateStatus("emailStatus", true, "Configured");
        }

        testConnection();
        addLog("System initialized successfully", "success");
      }

      document.addEventListener("DOMContentLoaded", initialize);
    </script>
  </body>
</html>
